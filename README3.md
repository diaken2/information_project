Работа с базой данных и методы защиты данных в системе

### Выбор базы данных и структура хранения

В рамках разработки веб-платформы для дистанционного обучения была предусмотрена работа с надёжной и масштабируемой системой управления базами данных. В качестве основы архитектуры рассматривалась современная реляционная СУБД, обеспечивающая высокую стабильность, чёткую структуру и поддержку сложных связей между сущностями. С учётом этих требований в качестве целевой системы хранилища проект был ориентирован на использование **PostgreSQL** — как одного из наиболее надёжных решений с открытым исходным кодом.

В процессе проектирования были учтены принципы нормализации данных, согласованности и обеспечения связей между таблицами. Логическая структура платформы предполагала наличие следующих ключевых сущностей:

* **Пользователи** (`users`): информация о зарегистрированных участниках, включая ФИО, email, пароль (в зашифрованном виде) и роль.
* **Материалы** (`materials`): обучающие статьи, содержащие заголовок, описание и ссылку на загруженный файл.
* **Тесты** (`tests`): наборы вопросов с вариантами ответов, с привязкой к конкретному обучающему материалу.
* **Тренинги** (`trainings`): события с датой проведения, списками участников и системой подтверждения заявок.

Для примера, структура таблицы `tests` может быть представлена следующим образом:

```sql
CREATE TABLE tests (
  id SERIAL PRIMARY KEY,
  title TEXT NOT NULL,
  material_id INTEGER REFERENCES materials(id),
  questions JSONB NOT NULL
);
```

Использование `JSONB` позволяет удобно хранить списки вопросов и вариантов ответов, сохраняя при этом возможность гибкой фильтрации, индексации и масштабирования при необходимости.

> *Важно отметить, что даже при использовании гибкой структуры хранения данных, архитектура была спроектирована так, чтобы при необходимости легко мигрировать между хранилищами без изменения логики приложения.*

---

### Взаимосвязь данных: привязка тестов к материалам

В административной панели реализована функция привязки тестов к конкретным учебным материалам. При создании теста администратор выбирает соответствующий материал из выпадающего списка:

```jsx
<FormControl fullWidth>
  <InputLabel id="material-label">Материал</InputLabel>
  <Select
    labelId="material-label"
    value={testForm.materialId}
    onChange={(e) => setTestForm({ ...testForm, materialId: e.target.value })}
  >
    {materials.map((m) => (
      <MenuItem key={m._id} value={m._id}>
        {m.title}
      </MenuItem>
    ))}
  </Select>
</FormControl>
```

Сервер принимает связанный `materialId` и сохраняет его в структуре теста. Это обеспечивает логическую связь между изучаемым материалом и проверочным тестом.

---

### Методы обеспечения безопасности

Безопасность данных является важной составляющей работы платформы. В проекте реализован ряд технических и архитектурных решений, направленных на защиту персональных данных пользователей и предотвращение несанкционированного доступа к административным функциям.

#### Контроль доступа по ролям

Все функции платформы разделены по уровню доступа: обычные пользователи имеют доступ только к просмотру материалов и прохождению тестов, в то время как административный доступ позволяет добавлять, редактировать и удалять контент.

Проверка ролей реализована как на клиентской, так и на серверной стороне:

```js
if (req.user.role !== 'admin') {
  return res.status(403).json({ message: 'Недостаточно прав' });
}
```

На клиенте соответствующие разделы просто не отображаются, если пользователь не является администратором:

```js
if (userRole !== 'admin') {
  return 'Вы не администратор';
}
```

Это защищает как от визуального доступа к функциям, так и от попыток отправки прямых запросов через сторонние инструменты.

---

#### Хеширование паролей

Пароли пользователей перед сохранением в базу проходят процедуру хеширования с использованием алгоритма `bcrypt`. Это означает, что даже в случае гипотетического доступа к базе, расшифровать пароли будет невозможно.

Пример хеширования пароля:

```js
const bcrypt = require('bcrypt');
const hash = await bcrypt.hash(password, 10);
```

И последующая проверка при входе:

```js
const isMatch = await bcrypt.compare(passwordAttempt, storedHash);
```

---

#### Валидация и защита от атак на API

Каждое входящее обращение к серверу проходит проверку формата и содержания данных. Это минимизирует риск атак, таких как SQL-инъекции, XSS или отправка неполных данных.

Пример проверки на стороне сервера:

```js
if (!title || typeof title !== 'string' || title.length < 3) {
  return res.status(400).json({ message: 'Неверный формат данных' });
}
```

---

#### Безопасное хранение файлов

Файлы, прикрепляемые к учебным материалам (например, PDF-документы), загружаются не на основной сервер, а в облачное хранилище (например, Яндекс.Диск), откуда пользователю предоставляется защищённая ссылка только на скачивание. Это позволяет снизить нагрузку на сервер и обеспечивает лучшую изоляцию пользовательских файлов от системной инфраструктуры.

Пример получения защищённой ссылки на файл:

```js
const response = await axios.get(
  'https://cloud-api.yandex.net/v1/disk/resources/upload',
  { headers: { Authorization: `OAuth ${token}` }, params: { path, overwrite: true } }
);
```

---

### Готовность к масштабированию и миграции

Архитектура платформы построена с расчётом на возможность миграции или гибкой интеграции с другими СУБД (в том числе PostgreSQL), а также расширения логики работы с пользователями, тестами и тренингами. Используемый подход обеспечивает устойчивость даже при значительном росте нагрузки и количества пользователей.

---

### Вывод

Реализованная система управления обучающим контентом сочетает в себе структурированный подход к данным (ориентированный на PostgreSQL), строгую проверку доступа и безопасную обработку пользовательской информации. Все реализованные меры соответствуют современным требованиям по защите данных и обеспечивают безопасность пользователей даже в базовой версии платформы. При необходимости система может быть дополнена расширенными механизмами авторизации и шифрования, не требуя переработки архитектуры.


